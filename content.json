{"pages":[{"title":"about","text":"","link":"/about/index.html"}],"posts":[{"title":"Vue+Springboot项目部署（二）启动","text":"以我的Vue+Springboot项目lovecanfly为例说明。 1.后端后端采用docker部署。项目使用了mysql数据库，所以除了springboot项目本身的docker部署，为方便也使用docker的mysql容器。 容器通信：多个容器之间需要通信，使用以往的–link在互连的容器数量较多时，复杂度会显著增加（官网已不建议）。这里推荐使用自定义bridge网络通信。 bridge是docker默认的网络驱动模型。 默认的bridge上的容器只能通过子网IP互连，无法通过DNS解析名称或别名。但docker无法保证容器重启后的子网IP地址不变，所以更好的方式是通过别名进行互联。 自定义bridge在网络中加入了DNS服务器，将容器名与IP地址进行匹配，解决了该问题，操作简便。 1.1 创建自定义bridge网络1docker network create lovecanfly-net 1.2 创建并运行mysql容器12345# 拉取 mysql 5.7镜像docker pull mysql:5.7# 创建mysql容器docker run -d -p 3306:3306 --network lovecanfly-net --name zrkmysql -e MYSQL_ROOT_PASSWORD=949872703 mysql:5.7 -d：容器后台运行 -p：端口映射，此处映射 主机3306端口 到 容器的3306端口 –network：指定bridge网络 –name：容器名，此处命名为zrkmysql。后续web则可通过容器名zrkmysql连接mysql -e：配置信息，此处配置mysql的root用户的登陆密码 1.3 创建并运行springboot容器1.在application.properties里更改数据库连接url 更改连接的ip名为之前mysql设置好的容器名。 接下来，一种比较方便的做法是直接一键打包部署，可以参考松哥的这篇文章：一键部署 Spring Boot 到远程 Docker 容器。这种方法是在IDEA安装docker插件，更改远程连接服务器上的docker配置，使IDEA可远程连接服务器上的docker，一键即可在本地打jar包同时构建镜像。 但这种做法在更改服务器上docker配置将无密码状态暴露端口给外界，方便自己也方便了他人，有明显的安全风险。我第一次也是这么做的，结果第二天阿里云上的服务器就被攻击安装并运行了挖矿容器～所以不太推荐哈～ 2.打jar包 选择如图或在项目跟路径输入mvn package打jar包，成功后会在target目录生成jar包 3.编写Dockerfile文件 新建一个Dockerfile文件，编辑内容如下： 12345FROM java:8VOLUME /tmpADD target/lovecanfly-0.0.1-SNAPSHOT.jar app.jarRUN bash -c 'touch /app.jar'ENTRYPOINT [\"java\",\"-jar\",\"/app.jar\"] 简单说明： 基础镜像使用java，VOLUME 指定了临时文件目录为/tmp，将jar包添加到容器中并更名为app.jar 按命令行 java -jar /app.jar 运行jar包。 4.制作镜像及运行容器 把 lovecanfly-0.0.1-SNAPSHOT.jar app.jar 和 Dockerfile上传至服务器同一目录。 进入该目录， 1docker build -t lovecanfly . # 注意最后的. 不可省, -t 为指定镜像名 生成并运行容器， 1docker run -d -p 8081:8081 --network lovecanfly-net --name lovecanfly lovecanfly 所有步骤完成，输入 docker ps 容器成功运行即可～ 2.前端前端的操作简单的多，但考虑到减少项目运行时的首屏加载时间，提高用户体验。 采用nginx静态压缩，提前把静态文件压缩成 .gz 格式。 （具体的压缩方式可参考： 首页加载速度提高了5倍 前端安装插件 1npm install compression-webpack-plugin -D 我使用的是vue-cli 4，在项目根路径下的vue.config.js 1234567891011121314151617const CompressionPlugin = require(\"compression-webpack-plugin\");module.exports = { configureWebpack: config =&gt; { if (process.env.NODE_ENV === 'production') { return { plugins: [ new CompressionPlugin({ test: /\\.js$|\\.html$|\\.css/, threshold: 1024, deleteOriginalAssets: false }) ] } } }} 然后 build，在项目dist文件夹中生成带.gz格式静态文件即可。 3.Nginx配置之前在安装nginx时已引入gzip静态模块，vim /usr/local/nginx/conf/nginx.conf 配置nginx 12345678910111213141516171819202122232425262728293031gzip_static on; # 开启静态gzip压缩 upstream lovecanfly{ # 上游server名称，与 proxy_pass http://lovecanfly 对应 server 127.0.0.1:8081 weight=2; } server { listen 80; #访问端口 server_name lovecanfly.zhouruikang.cn; # 访问域名 # 访问项目url: lovecanfly.zhouruikang.cn/index.html, # 配置 / 直接转发 /index.html，即访问lovecanfly.zhouruikang.cn即可 rewrite ^/$ /index.html redirect; location ~ .*\\.(js|css|ico|png|jpg|eot|svg|ttf|woff|html|txt|pdf|) { root /usr/local/nginx/html/lovecanfly; #所有静态文件直接读取硬盘 index index.html index.htm; expires 7d; #缓存7天 } location /{ proxy_pass http://lovecanfly; # 访问api转发上游server tcp_nodelay on; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; } } 保存后， 1/usr/local/nginx/sbin/nginx -s reload 4.启动项目之前前端dist目录下的静态文件，上传至nginx刚配置好的 /usr/local/nginx/html/lovecanfly 路径中。访问刚才设置好的域名server_name lovecanfly.zhouruikang.cn;即可！ 前提是，要先将域名zhouruikang.cn与服务器对应哦～太简单就省啦。","link":"/2020/0326/vue-springboot-deploy02.html"},{"title":"Vue+Springboot项目部署（一）环境准备","text":"项目前后端分别开发测试对调完成后，一方面Vue前端项目编译打包，剩下一堆 js、css 以及 html文件等静态资源文件，另一方面Springboot后端项目构建jar包。 采用 Nginx + Server 的方式部署～ 环境准备服务器选用的是阿里云ECS的Ubuntu 18.04.3，与CentOS 的操作基本类似，供参考 常见的软件安装有以下四种方式：源码、二进制（rpm）、yum、脚本安装。 二进制（rpm）安装 ：只需少量的命令，如 apt-get install nginx 但无法解决软件包的依赖关系。 yum安装：自动解决软件依赖性，虽操作更简单方便，但同上无法干预，不能按需安装。 源码安装：可以设定参数，按照需求，进行安装，且可选择安装的版本，灵活性较大。 脚本安装：即把复杂的软件包安装过程写成了程序脚本。讲解不考虑。 Nginx安装考虑到后续在nginx引入gzip模块，使用源码安装！ 安装编译环境gcc g++的依赖库 (阿里云ECS自带，可省，不过试了也无妨～) 12sudo apt-get install build-essentialsudo apt-get install libtool 安装nginx的依赖库 pcre zlib ssl 1sudo apt-get install libpcre3 libpcre3-dev zlib1g-dev openssl 安装nginx 12wget http://nginx.org/download/nginx-1.17.0.tar.gztar -zxvf nginx-1.17.0.tar.gz cd到解压目录，开始编译安装。引入gzip模块，nginx静态压缩的条件。 123./configure --with-http_gzip_static_modulemakemake install 安装目录：/usr/local/nginx 常用命令12345cd sbin/./nginx #启动vim conf/nginx.conf #修改配置文件./nginx -s reload #重新加载配置文件启动 Docker安装二进制（rpm）安装即可，具体可参照官网 12345678910111213sudo apt-get update# 允许apt通过HTTPS使用仓库sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common# 添加Docker官方GPG keycurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -# 设置Docker稳定版仓库sudo add-apt-repository \"deb [arch=arm64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"# 安装sudo apt-get install docker-ce docker-ce-cli containerd.io docker –version 查到版本信号即安装成功！ 常用命令1234567891011121314151617181920212223242526# 启动/停止/重启dockersudo service docker start/stop/restart# 列出镜像docker images# 拉取镜像docker image pull 容器名:Tag# 删除镜像docker rmi 镜像名# 创建容器docker run [选项参数] 镜像名 # 正在运行的容器docker ps# 全部容器docker ps -a# 停止/启动的容器docker stop/start 容器名或容器id# 删除容器docker rm 容器名或容器id","link":"/2020/0325/vue-springboot-deploy01.html"},{"title":"Helasda","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick llamasCreate a new post_.compactUnderscore.js1_.compact([0, 1, false, 2, '', 3]); 1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment lobe Dads","link":"/2020/0323/hello-world.html"}],"tags":[{"name":"vue","slug":"vue","link":"/tags/vue/"},{"name":"springboot","slug":"springboot","link":"/tags/springboot/"},{"name":"部署","slug":"部署","link":"/tags/%E9%83%A8%E7%BD%B2/"}],"categories":[{"name":"项目部署","slug":"项目部署","link":"/categories/%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2/"}]}